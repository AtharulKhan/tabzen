<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https: data: blob:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; script-src 'self'; connect-src 'self' https://api.openweathermap.org https://api.quotable.io; font-src 'self' https://fonts.gstatic.com;">
  <title>New Tab - TabZen</title>
  <link rel="stylesheet" href="../styles/global.css">
  <link rel="stylesheet" href="newtab.css">
  <link rel="stylesheet" href="../styles/commandPalette.css">
  <link rel="stylesheet" href="scratchpad.css">
  <link rel="stylesheet" href="../styles/visionBoard.css">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <h1 class="greeting" id="greeting">Good morning</h1>
        <p class="date-time" id="dateTime">Loading...</p>
      </div>
      <div class="header-right">
        <button class="icon-button" id="scratchpadBtn" aria-label="Open Scratchpad">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="9" y1="15" x2="15" y2="15"></line>
          </svg>
        </button>
        <button class="icon-button" id="visionBoardBtn" aria-label="Open Vision Board">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <polyline points="21 15 16 10 5 21"></polyline>
          </svg>
        </button>
        <button class="icon-button" id="settingsBtn" aria-label="Settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3m16.5-6.5L15 9m-6 6-4.5 4.5M19.5 17.5L15 15m-6-6L4.5 4.5"></path>
          </svg>
        </button>
        <button class="icon-button" id="themeToggle" aria-label="Toggle theme">
          <svg class="theme-icon-light" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
          <svg class="theme-icon-dark" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- Space Tabs -->
    <div class="space-tabs-container">
      <div class="space-tabs" id="spaceTabs">
        <!-- Space tabs will be dynamically added here -->
      </div>
      <button class="space-tab add-space-tab" id="addSpaceBtn" aria-label="Add new space">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
      <div class="search-wrapper">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          type="text" 
          id="searchInput" 
          class="search-input" 
          placeholder="Search Google or Bookmarks" 
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          autofocus
          tabindex="1"
        >
        <button class="search-help-btn" id="searchHelpBtn" aria-label="Search help">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
        </button>
        <div id="searchResults" class="search-results"></div>
        <div id="searchHelp" class="search-help-tooltip">
          <div class="search-help-title">Search Tips</div>
          <div class="search-help-item">
            <span class="search-help-prefix">=</span>
            <span>Calculator (e.g., = 2+2)</span>
          </div>
          <div class="search-help-item">
            <span class="search-help-prefix">bookmarks:</span>
            <span>Search bookmarks</span>
          </div>
          <div class="search-help-item">
            <span class="search-help-prefix">history:</span>
            <span>Search browser history</span>
          </div>
          <div class="search-help-item">
            <span class="search-help-prefix">tabs:</span>
            <span>Search open tabs</span>
          </div>
          <div class="search-help-item">
            <span class="search-help-prefix">widgets:</span>
            <span>Search widget content</span>
          </div>
          <div class="search-help-divider"></div>
          <div class="search-help-item">
            <span class="search-help-key">Cmd/Ctrl + Shift + P</span>
            <span>Command Palette</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Mini Quick Links Bar -->
    <div class="mini-quick-links-container" id="miniQuickLinks">
      <!-- Mini links will be dynamically inserted here -->
      <button class="mini-quick-link-add" id="miniQuickLinkAdd" title="Add quick link">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
    </div>

    <!-- Tab Canvas Workspace -->
    <div class="tab-canvas" id="tabCanvas">
      <div class="tab-canvas-inner" id="tabCanvasInner"></div>
      <div class="tab-canvas-empty" id="tabCanvasEmpty">
        <div class="tab-canvas-empty-illustration"></div>
        <h3>Blank Canvas for Your Tabs</h3>
        <p>Arrange floating tab cards anywhere, group them and jump back into your workflows in a click.</p>
        <button class="btn btn-primary" id="tabCanvasEmptyAdd">Add your first tab</button>
      </div>
      <button type="button" class="tab-canvas-resize-handle" id="tabCanvasResizeHandle" aria-label="Drag to resize canvas" title="Drag to resize canvas">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="8 6 12 2 16 6"></polyline>
          <line x1="12" y1="3" x2="12" y2="21"></line>
          <polyline points="8 18 12 22 16 18"></polyline>
        </svg>
        <span>Resize canvas</span>
      </button>
      <button class="tab-canvas-add-btn" id="tabCanvasAddBtn" aria-label="Add canvas tab tile">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
      <button class="tab-canvas-arrange-btn" id="tabCanvasArrangeBtn" aria-label="Auto arrange tiles" title="Auto arrange tiles">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"></rect>
          <rect x="14" y="3" width="7" height="7"></rect>
          <rect x="3" y="14" width="7" height="7"></rect>
          <rect x="14" y="14" width="7" height="7"></rect>
        </svg>
      </button>
      <div class="tab-canvas-search-container" id="tabCanvasSearchContainer">
        <button class="tab-canvas-search-btn" id="tabCanvasSearchBtn" aria-label="Search tabs" title="Search tabs">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
        <div class="tab-canvas-search-input-wrapper" id="tabCanvasSearchInputWrapper">
          <input type="text" class="tab-canvas-search-input" id="tabCanvasSearchInput" placeholder="Search tabs..." autocomplete="off">
          <button class="tab-canvas-search-clear" id="tabCanvasSearchClear" aria-label="Clear search" title="Clear search">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Group Detail Modal -->
    <div class="group-detail-modal" id="groupDetailModal">
      <div class="group-detail-content">
        <div class="group-detail-header">
          <h2 class="group-detail-title" id="groupDetailTitle">Group</h2>
          <div class="group-detail-actions">
            <button class="icon-button" id="openAllGroupTabs" title="Open all tabs">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2z"/>
              </svg>
            </button>
            <button class="icon-button" id="openGroupWindow" title="Open in window">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <line x1="9" y1="3" x2="9" y2="21"/>
              </svg>
            </button>
            <button class="icon-button" id="closeGroupModal" title="Close">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="group-detail-tiles" id="groupDetailTiles">
          <!-- Tiles will be dynamically inserted here -->
        </div>
      </div>
    </div>

    <!-- Widget Grid -->
    <main class="widget-grid" id="widgetGrid">
      <!-- Widgets will be dynamically inserted here -->
    </main>

    <!-- Add Widget Button -->
    <button class="add-widget-btn" id="addWidgetBtn" aria-label="Add widget">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    </button>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="icon-button" id="closeSettingsBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <h3>Appearance</h3>
          <label class="settings-item">
            <span>Theme</span>
            <select id="themeSelect">
              <option value="light">Light</option>
              <option value="dark">Dark</option>
              <option value="system">System</option>
            </select>
          </label>
          <label class="settings-item">
            <span>Background</span>
            <select id="backgroundType">
              <option value="gradient">Gradient</option>
              <option value="solid">Solid Color</option>
              <option value="none">None</option>
            </select>
          </label>
          <div id="gradientPresets" class="settings-item">
            <span>Gradient Style</span>
            <div class="gradient-presets">
              <button class="gradient-preset active" data-gradient="default" title="Default">
                <div class="gradient-preview" style="background: radial-gradient(circle at 20% 80%, #3b82f6 0%, transparent 50%), radial-gradient(circle at 80% 20%, #8b5cf6 0%, transparent 50%);"></div>
              </button>
              <button class="gradient-preset" data-gradient="sunset" title="Sunset">
                <div class="gradient-preview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);"></div>
              </button>
              <button class="gradient-preset" data-gradient="ocean" title="Ocean">
                <div class="gradient-preview" style="background: linear-gradient(135deg, #2e3192 0%, #1bffff 100%);"></div>
              </button>
              <button class="gradient-preset" data-gradient="forest" title="Forest">
                <div class="gradient-preview" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);"></div>
              </button>
              <button class="gradient-preset" data-gradient="lavender" title="Lavender">
                <div class="gradient-preview" style="background: linear-gradient(135deg, #c3cfe2 0%, #c3cfe2 50%, #fbc2eb 100%);"></div>
              </button>
              <button class="gradient-preset" data-gradient="peach" title="Peach">
                <div class="gradient-preview" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);"></div>
              </button>
            </div>
          </div>
          <div id="solidColorPicker" class="settings-item" style="display: none;">
            <span>Background Color</span>
            <input type="color" id="backgroundColor" value="#f3f4f6">
          </div>
          <label class="settings-item">
            <span>Background Opacity</span>
            <input type="range" id="backgroundOpacity" min="0" max="100" value="5">
            <span class="range-value">5%</span>
          </label>
          <label class="settings-item">
            <span>Grid Columns</span>
            <select id="gridColumns">
              <option value="3">3 columns</option>
              <option value="4" selected>4 columns</option>
              <option value="5">5 columns</option>
              <option value="6">6 columns</option>
            </select>
          </label>
          <label class="settings-item">
            <span>Widget Gap</span>
            <select id="widgetGap">
              <option value="12">Small</option>
              <option value="16" selected>Medium</option>
              <option value="24">Large</option>
            </select>
          </label>
        </div>
        <div class="settings-section">
          <h3>Templates</h3>
          <div class="template-actions">
            <button class="btn btn-primary" id="saveTemplateBtn">Save Current Dashboard</button>
            <button class="btn btn-secondary" id="manageTemplatesBtn">Manage Templates</button>
          </div>
          <div class="template-list-container" id="templateListContainer" style="display: none;">
            <div class="template-list" id="dashboardTemplateList">
              <!-- Templates will be dynamically inserted here -->
            </div>
          </div>
          
          <!-- Todo Templates Section -->
          <div class="template-subsection">
            <h4>Todo Templates</h4>
            <p class="template-description">Create and manage reusable checklists for your todo widgets</p>
            <div class="template-actions">
              <button class="btn btn-primary" id="createTodoTemplateBtn">Create Todo Template</button>
              <button class="btn btn-secondary" id="manageTodoTemplatesBtn">Manage Todo Templates</button>
            </div>
            <div class="template-list-container" id="todoTemplateListContainer" style="display: none;">
              <div class="template-list" id="todoTemplateList">
                <!-- Todo templates will be dynamically inserted here -->
              </div>
            </div>
          </div>
        </div>
        <div class="settings-section">
          <h3>Data</h3>
          <button class="btn btn-secondary" id="exportDataBtn">Export Data</button>
          <button class="btn btn-secondary" id="importDataBtn">Import Data</button>
          <input type="file" id="importFileInput" accept=".json" style="display: none;">
        </div>
      </div>
    </div>
  </div>

  <!-- Template Save Modal -->
  <div class="modal" id="templateSaveModal">
    <div class="modal-content modal-compact">
      <div class="modal-header">
        <h2>Save Dashboard Template</h2>
        <button class="icon-button" id="closeTemplateSaveBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="template-save-form">
          <label class="form-label">
            <span>Template Name</span>
            <input type="text" id="templateNameInput" class="form-input" placeholder="e.g., Work Dashboard" maxlength="50">
          </label>
          <label class="form-label">
            <span>Description (optional)</span>
            <textarea id="templateDescriptionInput" class="form-input" placeholder="Describe this template..." rows="3" maxlength="200"></textarea>
          </label>
          <div class="template-save-options">
            <label class="checkbox-label">
              <input type="checkbox" id="includeWidgetData" checked>
              <span>Include widget data (todos, notes, etc.)</span>
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelTemplateSaveBtn">Cancel</button>
          <button class="btn btn-primary" id="confirmTemplateSaveBtn">Save Template</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Template Apply Modal -->
  <div class="modal" id="templateApplyModal">
    <div class="modal-content modal-compact">
      <div class="modal-header">
        <h2 id="templateApplyTitle">Apply Template</h2>
        <button class="icon-button" id="closeTemplateApplyBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="template-apply-options">
          <div class="apply-option" data-mode="replace">
            <h4>Replace Current Dashboard</h4>
            <p>Clear everything and load the template</p>
          </div>
          <div class="apply-option" data-mode="merge">
            <h4>Merge with Current</h4>
            <p>Add template widgets to existing dashboard</p>
          </div>
          <div class="apply-option" data-mode="new-space">
            <h4>Create New Space</h4>
            <p>Load template in a new space</p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelTemplateApplyBtn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Space Editor Modal -->
  <div class="modal" id="spaceEditorModal">
    <div class="modal-content modal-compact">
      <div class="modal-header">
        <h2 id="spaceEditorTitle">New Space</h2>
        <button class="icon-button" id="closeSpaceEditorBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="space-editor-form">
          <label class="form-label">
            <span>Space Name</span>
            <input type="text" id="spaceNameInput" class="form-input" placeholder="Enter space name" maxlength="30">
          </label>
          <label class="form-label">
            <span>Icon</span>
            <div class="icon-picker" id="iconPicker">
              <!-- Icons will be dynamically added here -->
            </div>
          </label>
          <div class="form-label">
            <span>Space Layout</span>
            <div class="space-layout-options" id="spaceLayoutOptions">
              <button type="button" class="space-layout-option selected" data-layout="dashboard">
                <div class="space-layout-icon">
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="3" y="3" width="18" height="18" rx="4"></rect>
                    <path d="M9 3v18M3 9h18"></path>
                  </svg>
                </div>
                <div class="space-layout-copy">
                  <strong>Dashboard</strong>
                  <p>Widget grid with cards, todos, weather, and more.</p>
                </div>
              </button>
              <button type="button" class="space-layout-option" data-layout="tabCanvas">
                <div class="space-layout-icon">
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="4" y="4" width="8" height="6" rx="2"></rect>
                    <rect x="12" y="10" width="8" height="6" rx="2"></rect>
                    <rect x="6" y="14" width="8" height="6" rx="2"></rect>
                  </svg>
                </div>
                <div class="space-layout-copy">
                  <strong>Tab Canvas</strong>
                  <p>Blank workspace with movable tab cards you can drag anywhere.</p>
                </div>
              </button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelSpaceBtn">Cancel</button>
          <button class="btn btn-primary" id="saveSpaceBtn">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab Canvas Tile Modal -->
  <div class="modal" id="tabCanvasTileModal">
    <div class="modal-content modal-compact">
      <div class="modal-header">
        <h2 id="tabCanvasTileModalTitle">Add Canvas Tab</h2>
        <button class="icon-button" id="closeTabCanvasTileModal" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="space-editor-form">
          <label class="form-label">
            <span>Tab Name</span>
            <input type="text" id="tabCanvasTileName" class="form-input" placeholder="Design Sync" maxlength="60">
          </label>
          <label class="form-label">
            <span>URL</span>
            <input type="url" id="tabCanvasTileUrl" class="form-input" placeholder="https://example.com">
          </label>
          <div class="form-label">
            <span>Accent</span>
            <div class="tab-canvas-color-picker" id="tabCanvasTileColors">
              <button type="button" class="color-swatch selected" data-color="#EEF2FF" style="--swatch-color: #EEF2FF"></button>
              <button type="button" class="color-swatch" data-color="#E0E7FF" style="--swatch-color: #E0E7FF"></button>
              <button type="button" class="color-swatch" data-color="#E0F2FE" style="--swatch-color: #E0F2FE"></button>
              <button type="button" class="color-swatch" data-color="#ECFEFF" style="--swatch-color: #ECFEFF"></button>
              <button type="button" class="color-swatch" data-color="#D1FAE5" style="--swatch-color: #D1FAE5"></button>
              <button type="button" class="color-swatch" data-color="#FDE68A" style="--swatch-color: #FDE68A"></button>
              <button type="button" class="color-swatch" data-color="#FEF3C7" style="--swatch-color: #FEF3C7"></button>
              <button type="button" class="color-swatch" data-color="#FFE4E6" style="--swatch-color: #FFE4E6"></button>
              <button type="button" class="color-swatch" data-color="#FBCFE8" style="--swatch-color: #FBCFE8"></button>
              <button type="button" class="color-swatch" data-color="#F5D0FE" style="--swatch-color: #F5D0FE"></button>
              <button type="button" class="color-swatch" data-color="#EDE9FE" style="--swatch-color: #EDE9FE"></button>
              <button type="button" class="color-swatch" data-color="#F1F5F9" style="--swatch-color: #F1F5F9"></button>
              <label class="color-swatch color-swatch-custom" id="tabCanvasTileCustomColorSwatch" data-color="#A855F7" title="Choose a custom accent">
                <input type="color" id="tabCanvasTileCustomColor" value="#A855F7" aria-label="Choose a custom accent">
                <span>Custom</span>
              </label>
            </div>
          </div>
          <div class="form-error hidden" id="tabCanvasTileError">Please enter a valid URL</div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary danger hidden" id="deleteTabCanvasTileBtn">Remove</button>
          <div class="modal-footer-spacer"></div>
          <button class="btn btn-secondary" id="cancelTabCanvasTileBtn">Cancel</button>
          <button class="btn btn-primary" id="saveTabCanvasTileBtn">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Widget Gallery Modal -->
  <div class="modal" id="widgetGalleryModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add Widget</h2>
        <button class="icon-button" id="closeGalleryBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="widget-gallery" id="widgetGallery">
          <!-- Widget options will be dynamically inserted here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Todo Template Create Modal -->
  <div class="modal" id="todoTemplateModal">
    <div class="modal-content modal-compact">
      <div class="modal-header">
        <h2 id="todoTemplateModalTitle">Create Todo Template</h2>
        <button class="icon-button" id="closeTodoTemplateBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="todo-template-form">
          <input type="hidden" id="todoTemplateIdInput" value="">
          <label class="form-label">
            <span>Template Name</span>
            <input type="text" id="todoTemplateNameInput" class="form-input" placeholder="e.g., Daily Routine" maxlength="50">
          </label>
          <label class="form-label">
            <span>Tasks (one per line)</span>
            <textarea id="todoTemplateTasksInput" class="form-input" placeholder="Enter tasks, one per line..." rows="8"></textarea>
          </label>
          <div class="template-hint">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            <span>Tip: You can also save templates from existing todos using the todo widget's template button</span>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelTodoTemplateBtn">Cancel</button>
          <button class="btn btn-primary" id="saveTodoTemplateBtn">Save Template</button>
        </div>
      </div>
    </div>
    <!-- Vision Board Modal -->
    <div id="visionBoardModal" class="vision-board-modal" style="display: none;">
      <div class="vision-board-container">
        <div class="vision-board-header">
          <div class="vision-board-header-left">
            <h2 class="vision-board-title">Vision Board</h2>
            <select id="boardSelector" class="board-selector">
              <option value="">Select a board...</option>
            </select>
          </div>
          <div class="vision-board-header-right">
            <button class="icon-button" id="boardManageBtn" aria-label="Manage Board">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="12" cy="5" r="1"></circle>
                <circle cx="12" cy="19" r="1"></circle>
              </svg>
            </button>
            <button class="icon-button" id="visionBoardSaveBtn" aria-label="Save">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
              </svg>
            </button>
            <button class="icon-button" id="visionBoardExportBtn" aria-label="Export">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            </button>
            <button class="icon-button" id="visionBoardCloseBtn" aria-label="Close">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
        <div class="vision-board-toolbar">
          <button class="toolbar-btn active" id="selectTool" data-tool="select" aria-label="Select">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 3l18 6-6 2-2 6-6-18z"></path>
            </svg>
          </button>
          <button class="toolbar-btn" id="textTool" data-tool="text" aria-label="Add Text">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="4 7 4 4 20 4 20 7"></polyline>
              <line x1="9" y1="20" x2="15" y2="20"></line>
              <line x1="12" y1="4" x2="12" y2="20"></line>
            </svg>
          </button>
          <button class="toolbar-btn" id="imageTool" data-tool="image" aria-label="Add Image">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <circle cx="8.5" cy="8.5" r="1.5"></circle>
              <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
          </button>
          <button class="toolbar-btn" id="rectangleTool" data-tool="rectangle" aria-label="Add Rectangle">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            </svg>
          </button>
          <button class="toolbar-btn" id="circleTool" data-tool="circle" aria-label="Add Circle">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
            </svg>
          </button>
          <button class="toolbar-btn" id="lineTool" data-tool="line" aria-label="Add Line">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </button>
          <div class="toolbar-separator"></div>
          <button class="toolbar-btn" id="checkboxTool" data-tool="checkbox" aria-label="Add Checkbox">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 11 12 14 22 4"></polyline>
              <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
            </svg>
          </button>
          <button class="toolbar-btn" id="progressTool" data-tool="progress" aria-label="Add Progress Bar">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="4" y="10" width="16" height="4" rx="2" ry="2"></rect>
              <rect x="4" y="10" width="10" height="4" rx="2" ry="2" fill="currentColor"></rect>
            </svg>
          </button>
          <div class="toolbar-separator"></div>
          <button class="toolbar-btn" id="copyTool" aria-label="Copy Selected">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>
            </svg>
          </button>
          <button class="toolbar-btn" id="pasteTool" aria-label="Paste">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"></path>
              <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
            </svg>
          </button>
          <div class="toolbar-separator"></div>
          <button class="toolbar-btn" id="undoTool" aria-label="Undo" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 7v6h6"></path>
              <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"></path>
            </svg>
          </button>
          <button class="toolbar-btn" id="redoTool" aria-label="Redo" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 7v6h-6"></path>
              <path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"></path>
            </svg>
          </button>
          <div class="toolbar-separator"></div>
          <button class="toolbar-btn" id="deleteTool" aria-label="Delete Selected">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path>
            </svg>
          </button>
          <div class="toolbar-separator"></div>
          <button class="toolbar-btn" id="alignLeftTool" aria-label="Align Left">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="17" y1="10" x2="3" y2="10"></line>
              <line x1="21" y1="6" x2="3" y2="6"></line>
              <line x1="21" y1="14" x2="3" y2="14"></line>
              <line x1="17" y1="18" x2="3" y2="18"></line>
            </svg>
          </button>
          <button class="toolbar-btn" id="alignCenterTool" aria-label="Align Center">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="10" x2="6" y2="10"></line>
              <line x1="21" y1="6" x2="3" y2="6"></line>
              <line x1="21" y1="14" x2="3" y2="14"></line>
              <line x1="18" y1="18" x2="6" y2="18"></line>
            </svg>
          </button>
          <button class="toolbar-btn" id="alignRightTool" aria-label="Align Right">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="21" y1="10" x2="7" y2="10"></line>
              <line x1="21" y1="6" x2="3" y2="6"></line>
              <line x1="21" y1="14" x2="3" y2="14"></line>
              <line x1="21" y1="18" x2="7" y2="18"></line>
            </svg>
          </button>
          <button class="toolbar-btn" id="alignTopTool" aria-label="Align Top">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="10" y1="3" x2="10" y2="17"></line>
              <line x1="6" y1="3" x2="6" y2="21"></line>
              <line x1="14" y1="3" x2="14" y2="21"></line>
              <line x1="18" y1="3" x2="18" y2="17"></line>
            </svg>
          </button>
          <button class="toolbar-btn" id="alignMiddleTool" aria-label="Align Middle">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="10" y1="6" x2="10" y2="18"></line>
              <line x1="6" y1="3" x2="6" y2="21"></line>
              <line x1="14" y1="3" x2="14" y2="21"></line>
              <line x1="18" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
          <button class="toolbar-btn" id="alignBottomTool" aria-label="Align Bottom">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="10" y1="7" x2="10" y2="21"></line>
              <line x1="6" y1="3" x2="6" y2="21"></line>
              <line x1="14" y1="3" x2="14" y2="21"></line>
              <line x1="18" y1="7" x2="18" y2="21"></line>
            </svg>
          </button>
          <div class="toolbar-separator"></div>
          <button class="toolbar-btn" id="gridToggle" aria-label="Toggle Grid">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
          </button>
        </div>
        <div class="vision-board-canvas-container">
          <canvas id="visionBoardCanvas"></canvas>
        </div>
        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
        
        <!-- Text Formatting Toolbar -->
        <div id="textFormatToolbar" class="text-format-toolbar" style="display: none;">
          <select id="fontFamily" class="text-format-select">
            <option value="Arial">Arial</option>
            <option value="Helvetica">Helvetica</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Georgia">Georgia</option>
            <option value="Verdana">Verdana</option>
            <option value="Comic Sans MS">Comic Sans MS</option>
            <option value="Courier New">Courier New</option>
            <option value="Impact">Impact</option>
          </select>
          <select id="fontSize" class="text-format-select">
            <option value="12">12</option>
            <option value="14">14</option>
            <option value="16">16</option>
            <option value="18">18</option>
            <option value="20">20</option>
            <option value="24">24</option>
            <option value="28">28</option>
            <option value="32">32</option>
            <option value="36">36</option>
            <option value="48">48</option>
            <option value="72">72</option>
          </select>
          <button id="boldBtn" class="text-format-btn" aria-label="Bold">
            <strong>B</strong>
          </button>
          <button id="italicBtn" class="text-format-btn" aria-label="Italic">
            <em>I</em>
          </button>
          <button id="underlineBtn" class="text-format-btn" aria-label="Underline">
            <u>U</u>
          </button>
          <input type="color" id="textColor" class="text-format-color" aria-label="Text Color">
          <input type="color" id="bgColor" class="text-format-color" aria-label="Background Color">
        </div>
        
        <!-- Board Management Dropdown -->
        <div id="boardManageDropdown" class="board-manage-dropdown" style="display: none;">
          <button class="dropdown-item" id="renameBoardBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Rename Board
          </button>
          <button class="dropdown-item" id="duplicateBoardBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>
            </svg>
            Duplicate Board
          </button>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item delete-item" id="deleteBoardBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path>
            </svg>
            Delete Board
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="../libs/fabric.min.js"></script>
  <script src="../widgets/scratchpad.js"></script>
  <script type="module" src="newtab.js"></script>
</body>
</html>



