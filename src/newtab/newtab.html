<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Tab - TabZen</title>
  <link rel="stylesheet" href="../styles/global.css">
  <link rel="stylesheet" href="newtab.css">
  <link rel="stylesheet" href="../styles/commandPalette.css">
  <link rel="stylesheet" href="scratchpad.css">
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <h1 class="greeting" id="greeting">Good morning</h1>
        <p class="date-time" id="dateTime">Loading...</p>
      </div>
      <div class="header-right">
        <button class="icon-button" id="scratchpadBtn" aria-label="Open Scratchpad">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="9" y1="15" x2="15" y2="15"></line>
          </svg>
        </button>
        <button class="icon-button" id="settingsBtn" aria-label="Settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3m16.5-6.5L15 9m-6 6-4.5 4.5M19.5 17.5L15 15m-6-6L4.5 4.5"></path>
          </svg>
        </button>
        <button class="icon-button" id="themeToggle" aria-label="Toggle theme">
          <svg class="theme-icon-light" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
          <svg class="theme-icon-dark" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- Space Tabs -->
    <div class="space-tabs-container">
      <div class="space-tabs" id="spaceTabs">
        <!-- Space tabs will be dynamically added here -->
      </div>
      <button class="space-tab add-space-tab" id="addSpaceBtn" aria-label="Add new space">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
      <div class="search-wrapper">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          type="text" 
          id="searchInput" 
          class="search-input" 
          placeholder="Search Google or Bookmarks" 
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          autofocus
          tabindex="1"
        >
        <button class="search-help-btn" id="searchHelpBtn" aria-label="Search help">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
        </button>
        <div id="searchResults" class="search-results"></div>
        <div id="searchHelp" class="search-help-tooltip">
          <div class="search-help-title">Search Tips</div>
          <div class="search-help-item">
            <span class="search-help-prefix">=</span>
            <span>Calculator (e.g., = 2+2)</span>
          </div>
          <div class="search-help-item">
            <span class="search-help-prefix">bookmarks:</span>
            <span>Search bookmarks</span>
          </div>
          <div class="search-help-item">
            <span class="search-help-prefix">history:</span>
            <span>Search browser history</span>
          </div>
          <div class="search-help-item">
            <span class="search-help-prefix">tabs:</span>
            <span>Search open tabs</span>
          </div>
          <div class="search-help-item">
            <span class="search-help-prefix">widgets:</span>
            <span>Search widget content</span>
          </div>
          <div class="search-help-divider"></div>
          <div class="search-help-item">
            <span class="search-help-key">Cmd/Ctrl + Shift + P</span>
            <span>Command Palette</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Widget Grid -->
    <main class="widget-grid" id="widgetGrid">
      <!-- Widgets will be dynamically inserted here -->
    </main>

    <!-- Add Widget Button -->
    <button class="add-widget-btn" id="addWidgetBtn" aria-label="Add widget">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    </button>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="icon-button" id="closeSettingsBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <h3>Appearance</h3>
          <label class="settings-item">
            <span>Theme</span>
            <select id="themeSelect">
              <option value="light">Light</option>
              <option value="dark">Dark</option>
              <option value="system">System</option>
            </select>
          </label>
          <label class="settings-item">
            <span>Background</span>
            <select id="backgroundType">
              <option value="gradient">Gradient</option>
              <option value="solid">Solid Color</option>
              <option value="none">None</option>
            </select>
          </label>
          <div id="gradientPresets" class="settings-item">
            <span>Gradient Style</span>
            <div class="gradient-presets">
              <button class="gradient-preset active" data-gradient="default" title="Default">
                <div class="gradient-preview" style="background: radial-gradient(circle at 20% 80%, #3b82f6 0%, transparent 50%), radial-gradient(circle at 80% 20%, #8b5cf6 0%, transparent 50%);"></div>
              </button>
              <button class="gradient-preset" data-gradient="sunset" title="Sunset">
                <div class="gradient-preview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);"></div>
              </button>
              <button class="gradient-preset" data-gradient="ocean" title="Ocean">
                <div class="gradient-preview" style="background: linear-gradient(135deg, #2e3192 0%, #1bffff 100%);"></div>
              </button>
              <button class="gradient-preset" data-gradient="forest" title="Forest">
                <div class="gradient-preview" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);"></div>
              </button>
              <button class="gradient-preset" data-gradient="lavender" title="Lavender">
                <div class="gradient-preview" style="background: linear-gradient(135deg, #c3cfe2 0%, #c3cfe2 50%, #fbc2eb 100%);"></div>
              </button>
              <button class="gradient-preset" data-gradient="peach" title="Peach">
                <div class="gradient-preview" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);"></div>
              </button>
            </div>
          </div>
          <div id="solidColorPicker" class="settings-item" style="display: none;">
            <span>Background Color</span>
            <input type="color" id="backgroundColor" value="#f3f4f6">
          </div>
          <label class="settings-item">
            <span>Background Opacity</span>
            <input type="range" id="backgroundOpacity" min="0" max="100" value="5">
            <span class="range-value">5%</span>
          </label>
          <label class="settings-item">
            <span>Grid Columns</span>
            <select id="gridColumns">
              <option value="3">3 columns</option>
              <option value="4" selected>4 columns</option>
              <option value="5">5 columns</option>
              <option value="6">6 columns</option>
            </select>
          </label>
          <label class="settings-item">
            <span>Widget Gap</span>
            <select id="widgetGap">
              <option value="12">Small</option>
              <option value="16" selected>Medium</option>
              <option value="24">Large</option>
            </select>
          </label>
        </div>
        <div class="settings-section">
          <h3>Templates</h3>
          <div class="template-actions">
            <button class="btn btn-primary" id="saveTemplateBtn">Save Current Dashboard</button>
            <button class="btn btn-secondary" id="manageTemplatesBtn">Manage Templates</button>
          </div>
          <div class="template-list-container" id="templateListContainer" style="display: none;">
            <div class="template-list" id="dashboardTemplateList">
              <!-- Templates will be dynamically inserted here -->
            </div>
          </div>
          
          <!-- Todo Templates Section -->
          <div class="template-subsection">
            <h4>Todo Templates</h4>
            <p class="template-description">Create and manage reusable checklists for your todo widgets</p>
            <div class="template-actions">
              <button class="btn btn-primary" id="createTodoTemplateBtn">Create Todo Template</button>
              <button class="btn btn-secondary" id="manageTodoTemplatesBtn">Manage Todo Templates</button>
            </div>
            <div class="template-list-container" id="todoTemplateListContainer" style="display: none;">
              <div class="template-list" id="todoTemplateList">
                <!-- Todo templates will be dynamically inserted here -->
              </div>
            </div>
          </div>
        </div>
        <div class="settings-section">
          <h3>Data</h3>
          <button class="btn btn-secondary" id="exportDataBtn">Export Data</button>
          <button class="btn btn-secondary" id="importDataBtn">Import Data</button>
          <input type="file" id="importFileInput" accept=".json" style="display: none;">
        </div>
      </div>
    </div>
  </div>

  <!-- Template Save Modal -->
  <div class="modal" id="templateSaveModal">
    <div class="modal-content modal-compact">
      <div class="modal-header">
        <h2>Save Dashboard Template</h2>
        <button class="icon-button" id="closeTemplateSaveBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="template-save-form">
          <label class="form-label">
            <span>Template Name</span>
            <input type="text" id="templateNameInput" class="form-input" placeholder="e.g., Work Dashboard" maxlength="50">
          </label>
          <label class="form-label">
            <span>Description (optional)</span>
            <textarea id="templateDescriptionInput" class="form-input" placeholder="Describe this template..." rows="3" maxlength="200"></textarea>
          </label>
          <div class="template-save-options">
            <label class="checkbox-label">
              <input type="checkbox" id="includeWidgetData" checked>
              <span>Include widget data (todos, notes, etc.)</span>
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelTemplateSaveBtn">Cancel</button>
          <button class="btn btn-primary" id="confirmTemplateSaveBtn">Save Template</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Template Apply Modal -->
  <div class="modal" id="templateApplyModal">
    <div class="modal-content modal-compact">
      <div class="modal-header">
        <h2 id="templateApplyTitle">Apply Template</h2>
        <button class="icon-button" id="closeTemplateApplyBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="template-apply-options">
          <div class="apply-option" data-mode="replace">
            <h4>Replace Current Dashboard</h4>
            <p>Clear everything and load the template</p>
          </div>
          <div class="apply-option" data-mode="merge">
            <h4>Merge with Current</h4>
            <p>Add template widgets to existing dashboard</p>
          </div>
          <div class="apply-option" data-mode="new-space">
            <h4>Create New Space</h4>
            <p>Load template in a new space</p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelTemplateApplyBtn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Space Editor Modal -->
  <div class="modal" id="spaceEditorModal">
    <div class="modal-content modal-compact">
      <div class="modal-header">
        <h2 id="spaceEditorTitle">New Space</h2>
        <button class="icon-button" id="closeSpaceEditorBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="space-editor-form">
          <label class="form-label">
            <span>Space Name</span>
            <input type="text" id="spaceNameInput" class="form-input" placeholder="Enter space name" maxlength="30">
          </label>
          <label class="form-label">
            <span>Icon</span>
            <div class="icon-picker" id="iconPicker">
              <!-- Icons will be dynamically added here -->
            </div>
          </label>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelSpaceBtn">Cancel</button>
          <button class="btn btn-primary" id="saveSpaceBtn">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Widget Gallery Modal -->
  <div class="modal" id="widgetGalleryModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add Widget</h2>
        <button class="icon-button" id="closeGalleryBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="widget-gallery" id="widgetGallery">
          <!-- Widget options will be dynamically inserted here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Todo Template Create Modal -->
  <div class="modal" id="todoTemplateModal">
    <div class="modal-content modal-compact">
      <div class="modal-header">
        <h2 id="todoTemplateModalTitle">Create Todo Template</h2>
        <button class="icon-button" id="closeTodoTemplateBtn" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="todo-template-form">
          <input type="hidden" id="todoTemplateIdInput" value="">
          <label class="form-label">
            <span>Template Name</span>
            <input type="text" id="todoTemplateNameInput" class="form-input" placeholder="e.g., Daily Routine" maxlength="50">
          </label>
          <label class="form-label">
            <span>Tasks (one per line)</span>
            <textarea id="todoTemplateTasksInput" class="form-input" placeholder="Enter tasks, one per line..." rows="8"></textarea>
          </label>
          <div class="template-hint">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            <span>Tip: You can also save templates from existing todos using the todo widget's template button</span>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelTodoTemplateBtn">Cancel</button>
          <button class="btn btn-primary" id="saveTodoTemplateBtn">Save Template</button>
        </div>
      </div>
    </div>
  </div>

  <script src="../widgets/scratchpad.js"></script>
  <script type="module" src="newtab.js"></script>
</body>
</html>